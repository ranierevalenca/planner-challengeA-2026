<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>Planner Challenge A – Web</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6f8;
  margin: 0;
  padding: 20px;
}

h1 {
  text-align: center;
}

.controls {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  justify-content: center;
  margin-bottom: 20px;
}

input[type="date"], select, button {
  padding: 8px;
  font-size: 14px;
}

.week {
  background: white;
  border-radius: 8px;
  padding: 15px;
  margin-bottom: 20px;
}

.week-header {
  font-weight: bold;
  margin-bottom: 10px;
}

.day {
  border: 1px solid #ddd;
  border-radius: 6px;
  padding: 10px;
  margin-bottom: 10px;
}

.day.today {
  border: 2px solid #0077cc;
  background: #eef6ff;
}

.day label {
  font-weight: bold;
  display: block;
  margin-bottom: 5px;
}

textarea {
  width: 100%;
  height: 60px;
  resize: vertical;
}

.hidden {
  display: none;
}

@media print {
  .controls {
    display: none;
  }
}
</style>
</head>

<body>

<h1>Planner Challenge A – Web</h1>

<div class="controls">
  <input type="date" id="startDate">
  <select id="weekSelector"></select>
  <button onclick="showSelectedWeek()">Mostrar semana</button>
  <button onclick="showAllWeeks()">Mostrar todas</button>
  <button onclick="printWeek()">Imprimir semana</button>
</div>

<div id="planner"></div>

<script>
const planner = document.getElementById("planner");
const weekSelector = document.getElementById("weekSelector");
const startDateInput = document.getElementById("startDate");

const DAYS = ["Segunda", "Terça", "Quarta", "Quinta", "Sexta", "Sábado", "Domingo"];
let weeks = [];

/* ===== Utilidades ===== */
function formatDate(date) {
  return date.toISOString().split("T")[0];
}

function getMonday(date) {
  const d = new Date(date);
  const day = d.getDay() || 7;
  if (day !== 1) d.setDate(d.getDate() - day + 1);
  return d;
}

/* ===== Criar semana ===== */
function createWeek(startDate) {
  const monday = getMonday(startDate);
  const weekId = formatDate(monday);

  if (weeks.find(w => w.id === weekId)) return;

  const week = { id: weekId, days: [] };

  for (let i = 0; i < 7; i++) {
    const d = new Date(monday);
    d.setDate(d.getDate() + i);

    week.days.push({
      name: DAYS[i],
      date: formatDate(d),
      text: localStorage.getItem(`${weekId}-${i}`) || ""
    });
  }

  weeks.push(week);
  updateSelector();
  render();
}

/* ===== Renderização ===== */
function render(showAll = false) {
  planner.innerHTML = "";

  const todayStr = formatDate(new Date());

  weeks.forEach((week, wIndex) => {
    const container = document.createElement("div");
    container.className = "week";
    if (!showAll && weekSelector.value !== week.id) {
      container.classList.add("hidden");
    }

    const header = document.createElement("div");
    header.className = "week-header";
    header.innerText = `Semana iniciando em ${week.id}`;
    container.appendChild(header);

    week.days.forEach((day, dIndex) => {
      const dayDiv = document.createElement("div");
      dayDiv.className = "day";
      if (day.date === todayStr) dayDiv.classList.add("today");

      const label = document.createElement("label");
      label.innerText = `${day.name} – ${day.date}`;
      dayDiv.appendChild(label);

      const textarea = document.createElement("textarea");
      textarea.value = day.text;
      textarea.oninput = () => {
        localStorage.setItem(`${week.id}-${dIndex}`, textarea.value);
        week.days[dIndex].text = textarea.value;
      };

      dayDiv.appendChild(textarea);
      container.appendChild(dayDiv);
    });

    planner.appendChild(container);
  });
}

/* ===== Controles ===== */
function updateSelector() {
  weekSelector.innerHTML = "";
  weeks.forEach(w => {
    const opt = document.createElement("option");
    opt.value = w.id;
    opt.innerText = `Semana ${w.id}`;
    weekSelector.appendChild(opt);
  });
}

function showSelectedWeek() {
  render(false);
}

function showAllWeeks() {
  render(true);
}

function printWeek() {
  render(false);
  window.print();
}

/* ===== Eventos ===== */
startDateInput.addEventListener("change", e => {
  createWeek(new Date(e.target.value));
});

/* ===== Inicialização ===== */
const savedWeeks = Object.keys(localStorage)
  .map(k => k.split("-")[0])
  .filter((v, i, a) => a.indexOf(v) === i);

savedWeeks.forEach(w => createWeek(new Date(w)));

if (weeks.length) {
  weekSelector.value = weeks[0].id;
  render(false);
}
</script>

</body>
</html>
